# Парсер сайта online.metro-cc.ru

Этот репозиторий содержит парсер для сайта online.metro-cc.ru, который позволяет спарсить все товары в категории. Парсер работает для всех городов, что есть на сайте достаточно выбрать из списка в программе нужный город, после чего выгружает данные в json файл. По умолчанию парсер собирает данные только товаров что есть в наличии.

## Собранные данные
Для каждого товара, парсер собирает следующие данные:

- id товара из сайта
- наименование товара
- ссылка на товар
- регулярная цена
- промо цена
- бренд (сбор инфомации бренда,занимает очень много врмеени, поскольку на страници каталога нет инфомации о бренде и приходится заходить на страницу скаждого продукта) 

## Установка
Скачайте репозиторий `git clone https://github.com/Doppelgangers/ParserShop`

#### Автоматическая установка через  скрипт .bat
1. Запустите файл `insatll.bat`
2. Для запуска программы используйте `start.bat` 
ИЛИ 
#### Ручная установка 

1. Установите зависимости, указанные в файле requirements.txt, с помощью следующей команды:
    ```
    cmd
    pip install -r requirements.txt
    ```
2. Запустите скрипт main.py:
    ```
    cmd
    python main.py
    ```

## Использование

1. Введите ссылку на категорию которую вы хотите спарсить.
    ``` 
    Введите ссылку на категорию: https://online.metro-cc.ru/category/ovoshchi-i-frukty/frukty
    ```
    Парсер способен так же обрабатывать ссылкки содержащие поиск товара, такие как https://online.metro-cc.ru/search?q=%D0%BC%D0%BE%D1%82%D0%BE%D1%80%D0%BD%D1%8B%D0%B5%20%D0%BC%D0%B0%D1%81%D0%BB%D0%B0&from=under_search 

2. Появится список id и городов, укажите id города или введите `list` что бы открыть полсый список городов.
    ```
    Магазины Санкт-Петербургa:
      ID: 15 | Адрес: 'Комендантский проспект,  д.3, лит. А'
      ID: 16 | Адрес: 'пр-т Косыгина, д.4, лит. А'
      ID: 20 | Адрес: 'Пулковское шоссе, д.23, лит. A'
    ________________________________________________________________
    Введите ID: магазина METRO который необходимо спарсить.
    Для вывода всех магазинов введите list
    --> 16
    ```

3. Парсер начнёт поиск данных в 2 этапа, для начала он пройдется по всем страницам пагинации в выбраной категории с фмльтром `есть в наличии` и соберёт все доступные данные (id, название, обычная цена, скидочная цена, ссылка на товар)
    ```
    Элементов:  55
    Загрузка данных из каталога завершена за 6.771671533584595 секунд.
    ```

4. После чего парсер достанет недостающие данные входя на страницу каждого товра, это может занять доволно длительное время (в зваисимости от количества товаров)
    ```
    Элементов:  55
    Загрузка данных о каждом продукте завершена за 10.828275680541992 секунд.
    ```
5. Результаты парсинга будут сохранены по умолчанию в папке jsons в корне проекта.
    ```
    Данные сохранены в jsons\2023_10_11_17_12_Москва_Ленинградское_ш__д_71Г_onlineMetroRu    .json
    ```
## Проблемы и их решения
1) Программа перестала запускаться
    Причиной этому может послужить неточности в файле config.json в корне файла скрипта в папке congfigs, удалите его иснова запустите скрипт.
    
    Так же возможно что на сайте произошли изменеия в коде страницы, в следствии чего парсер не будет работать пока не будут внесены правки в скрипт.

2) Во время второго этапра парсинга произошла ошибка.
    Вероятнее всего парсилась слишком большое количество файлов (скорее всего подряд) в следствии чего сервер разорвал соеденение с парсером. 
    
## TODO:
1) Сделать защиту от разрва соеденения, класс для сбора задач что были завершены не успешно, отправить вновь на парсинг после небольшой паузы.
2) Переработаь конфигруационный файл
3) Переработать консольный интерфейс или сделать GUI
4) Распределить классы из файла main.py в отдельные отдельные файлы в папке hendlers

## Репозиторий

Вы можете найти код скрипта, файл с результатами парсинга и файл requirements.txt в публичном репозитории на GitHub. [Ссылка на репозиторий](https://github.com/Doppelgangers/ParserShop)